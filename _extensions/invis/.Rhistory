return(df)
}
FinancialYearMonthlyTable <- function(df, start_fy_year = 2025) {
library(dplyr)
library(lubridate)
start_date <- as.Date(paste0(start_fy_year, "-04-01"))
end_date <- as.Date(paste0(start_fy_year + 1, "-03-31"))
fy_data <- df %>%
filter(Date >= start_date & Date <= end_date) %>%
mutate(Month = format(Date, "%Y-%m")) %>%
select(-Date)
# Identify numeric columns only (accounts)
numeric_cols <- sapply(fy_data, is.numeric)
# Add a Total column summing only numeric columns
fy_data <- fy_data %>%
mutate(Total = rowSums(across(which(numeric_cols))))
# Add a Total row summing columns (including Total column)
total_row <- fy_data %>%
summarise(across(where(is.numeric), sum)) %>%
mutate(Month = "Total")
# Bind total row at the bottom
result <- bind_rows(fy_data, total_row)
# Reorder columns so Month is first
result <- result %>%
select(Month, everything())
return(result)
}
interest_data <- Add_FixedTerm18mo(interest_data)
interest_data <- Add_MonthlyPaymentAccount(interest_data)
interest_data <- Add_MonthlyPaymentAccount2(interest_data)
interest_data <- Add_Trading212(interest_data)
interest_data <- Add_Trading212_2(interest_data)
library(tidyverse)
library(lubridate)
interest_data <- tibble(
Date = seq.Date(from = as.Date("2024-01-01"), to = as.Date("2030-04-01"), by = "month")
)
PlotCumulativeInterestByFY <- function(df, start_years = c(2025, 2026)) {
library(dplyr)
library(tidyr)
library(ggplot2)
library(lubridate)
get_financial_year <- function(date) {
yr <- year(date)
if (month(date) < 4) {
yr - 1
} else {
yr
}
}
df <- df %>%
mutate(
FinancialYear = map_int(Date, get_financial_year)
) %>%
filter(FinancialYear %in% start_years)
plot_list <- list()
for (fy in start_years) {
df_fy <- df %>%
filter(FinancialYear == fy) %>%
arrange(Date)
# Calculate total interest per date (sum of accounts)
df_fy <- df_fy %>%
mutate(Total = rowSums(select(., -Date, -FinancialYear)))
# Pivot longer for accounts + Total
df_long <- df_fy %>%
select(-FinancialYear) %>%
pivot_longer(cols = -Date, names_to = "Account", values_to = "Interest") %>%
group_by(Account) %>%
mutate(Cumulative = cumsum(Interest)) %>%
ungroup()
p <- ggplot(df_long, aes(x = Date, y = Cumulative, color = Account)) +
geom_line(size = 1.2) +
geom_hline(yintercept = 1000, linetype = "dotted", color = "black") +
labs(
title = paste0("Cumulative Interest Earned - Financial Year ", fy, "-", fy + 1),
x = "Date",
y = "Cumulative Interest ($)"
) +
scale_x_date(date_labels = "%b %Y", date_breaks = "1 month") +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
plot_list[[paste0("FY_", fy, "_", fy + 1)]] <- p
}
return(plot_list)
}
ProjectedSummary <- function(df, year) {
df %>%
filter(year(Date) == year) %>%
select(-Date) %>%
summarise_all(sum)
}
Add_FixedTerm18mo <- function(df) {
account_name <- "Fixed Term 18mo"
open_date <- as.Date("2025-06-12")
close_date <- as.Date("2026-12-12")
principal <- 10000
rate <- 0.05
df$Date <- as.Date(df$Date)
interest_dates <- as.Date(c("2026-06-12", "2026-12-12"))
df[[account_name]] <- 0
# Start with last interest date = open date
last_interest_date <- open_date
for (int_date in interest_dates) {
int_date <- as.Date(int_date)
month_row <- which(format(df$Date, "%Y-%m") == format(int_date, "%Y-%m"))
if (length(month_row) == 1) {
# Calculate only the time since last interest payment
time <- as.numeric(difftime(int_date, last_interest_date, units = "days")) / 365.25
interest <- principal * rate * time
df[[account_name]][month_row] <- interest
principal <- principal + interest
# Update last_interest_date for next iteration
last_interest_date <- int_date
}
}
return(df)
}
Add_MonthlyPaymentAccount <- function(df) {
account_name <- "Monthly Payment Account"
open_date <- as.Date("2024-10-17")
interest_payment_date <- open_date %m+% months(12)  # 12 months after opening
monthly_payment <- 200
rate <- 0.065
df$Date <- as.Date(df$Date)
# Initialize the account column with 0
df[[account_name]] <- 0
# Calculate number of payments made by each month
# Payments start the month after opening (assumed)
df <- df %>%
mutate(
PaymentsMade = if_else(Date >= (open_date %m+% months(1)),
pmin(as.integer(interval(open_date, Date) %/% months(1)) + 1, 12),
0),
Principal = PaymentsMade * monthly_payment
)
# Find row of interest payment month
int_row <- which(format(df$Date, "%Y-%m") == format(interest_payment_date, "%Y-%m"))
if (length(int_row) == 1) {
# Interest calculated on the total principal accumulated over 12 months
# For simplicity, assume monthly contributions do not accrue interest until the 12 months are complete (i.e., no compounding during the year)
# Average principal over the year can be approximated as sum of an arithmetic series:
# total principal = 200 * 12 = 2400
# Average principal over year = 200 * (1 + 12)/2 = 1300 (since contributions happen monthly)
# Interest = average principal * rate * 1 year
avg_principal <- monthly_payment * (1 + 12) / 2
interest <- avg_principal * rate * 1
df[[account_name]][int_row] <- interest
}
# Remove helper columns
df <- df %>% select(-PaymentsMade, -Principal)
return(df)
}
Add_Trading212 <- function(df) {
account_name <- "Trading212"
# Initialize column with zeros
df[[account_name]] <- 0
# Specific interest payment dates and amounts
interest_dates <- as.Date(c("2025-05-01", "2025-06-01"))  # Using 1st of month for June
interest_amounts <- c(74.31, 73.94)
df$Date <- as.Date(df$Date)
for (i in seq_along(interest_dates)) {
# Find the row matching year-month of interest payment date
row_idx <- which(format(df$Date, "%Y-%m") == format(interest_dates[i], "%Y-%m"))
if (length(row_idx) == 1) {
df[[account_name]][row_idx] <- interest_amounts[i]
}
}
return(df)
}
Add_Trading212_new <- function(df) {
account_name <- "Trading212 2"
opening_balance <- 3215.76
annual_rate <- 0.041
monthly_rate <- annual_rate / 12
df[[account_name]] <- 0  # Initialize
# Find rows starting from June 2025
start_row <- which(df$Date >= as.Date("2025-06-01"))[1]
if (is.na(start_row)) return(df)  # If June 2025 isn't in df, return as-is
balance <- opening_balance
for (i in seq(start_row, nrow(df))) {
interest <- balance * monthly_rate
df[[account_name]][i] <- interest
balance <- balance + interest  # Compound
}
return(df)
}
Add_MonthlyPaymentAccount2 <- function(df) {
account_name <- "Lloyds Saver"
open_date <- as.Date("2025-05-05")
interest_payment_date <- open_date %m+% months(12)  # 12 months after opening
monthly_payment <- 400
rate <- 0.0625
df$Date <- as.Date(df$Date)
# Initialize the account column with 0
df[[account_name]] <- 0
# Calculate number of payments made by each month (starting the month of open_date)
df <- df %>%
mutate(
PaymentsMade = if_else(Date >= open_date,
pmin(as.integer(interval(open_date, Date) %/% months(1)) + 1, 12),
0),
Principal = PaymentsMade * monthly_payment
)
# Find row of interest payment month
int_row <- which(format(df$Date, "%Y-%m") == format(interest_payment_date, "%Y-%m"))
if (length(int_row) == 1) {
# Calculate average principal over the year as arithmetic mean of monthly contributions
avg_principal <- monthly_payment * (1 + 12) / 2
interest <- avg_principal * rate * 1  # 1 year interest
df[[account_name]][int_row] <- interest
}
# Remove helper columns
df <- df %>% select(-PaymentsMade, -Principal)
return(df)
}
FinancialYearMonthlyTable <- function(df, start_fy_year = 2025) {
library(dplyr)
library(lubridate)
start_date <- as.Date(paste0(start_fy_year, "-04-01"))
end_date <- as.Date(paste0(start_fy_year + 1, "-03-31"))
fy_data <- df %>%
filter(Date >= start_date & Date <= end_date) %>%
mutate(Month = format(Date, "%Y-%m")) %>%
select(-Date)
# Identify numeric columns only (accounts)
numeric_cols <- sapply(fy_data, is.numeric)
# Add a Total column summing only numeric columns
fy_data <- fy_data %>%
mutate(Total = rowSums(across(which(numeric_cols))))
# Add a Total row summing columns (including Total column)
total_row <- fy_data %>%
summarise(across(where(is.numeric), sum)) %>%
mutate(Month = "Total")
# Bind total row at the bottom
result <- bind_rows(fy_data, total_row)
# Reorder columns so Month is first
result <- result %>%
select(Month, everything())
return(result)
}
interest_data <- Add_FixedTerm18mo(interest_data)
interest_data <- Add_MonthlyPaymentAccount(interest_data)
interest_data <- Add_MonthlyPaymentAccount2(interest_data)
interest_data <- Add_Trading212(interest_data)
interest_data <- Add_Trading212_new(interest_data)
interest_data
plots <- PlotCumulativeInterestByFY(interest_data, start_years = c(2025, 2026))
# To display the plots, e.g. in RStudio:
print(plots$FY_2025_2026)
print(plots$FY_2026_2027)
ProjectedSummary(interest_data, 2026)
FinancialYearMonthlyTable(interest_data, 2025)
FinancialYearMonthlyTable(interest_data, 2026)
library(tidyverse)
library(lubridate)
interest_data <- tibble(
Date = seq.Date(from = as.Date("2024-01-01"), to = as.Date("2030-04-01"), by = "month")
)
PlotCumulativeInterestByFY <- function(df, start_years = c(2025, 2026)) {
library(dplyr)
library(tidyr)
library(ggplot2)
library(lubridate)
get_financial_year <- function(date) {
yr <- year(date)
if (month(date) < 4) {
yr - 1
} else {
yr
}
}
df <- df %>%
mutate(
FinancialYear = map_int(Date, get_financial_year)
) %>%
filter(FinancialYear %in% start_years)
plot_list <- list()
for (fy in start_years) {
df_fy <- df %>%
filter(FinancialYear == fy) %>%
arrange(Date)
# Calculate total interest per date (sum of accounts)
df_fy <- df_fy %>%
mutate(Total = rowSums(select(., -Date, -FinancialYear)))
# Pivot longer for accounts + Total
df_long <- df_fy %>%
select(-FinancialYear) %>%
pivot_longer(cols = -Date, names_to = "Account", values_to = "Interest") %>%
group_by(Account) %>%
mutate(Cumulative = cumsum(Interest)) %>%
ungroup()
p <- ggplot(df_long, aes(x = Date, y = Cumulative, color = Account)) +
geom_line(size = 1.2) +
geom_hline(yintercept = 1000, linetype = "dotted", color = "black") +
labs(
title = paste0("Cumulative Interest Earned - Financial Year ", fy, "-", fy + 1),
x = "Date",
y = "Cumulative Interest ($)"
) +
scale_x_date(date_labels = "%b %Y", date_breaks = "1 month") +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
plot_list[[paste0("FY_", fy, "_", fy + 1)]] <- p
}
return(plot_list)
}
ProjectedSummary <- function(df, year) {
df %>%
filter(year(Date) == year) %>%
select(-Date) %>%
summarise_all(sum)
}
Add_FixedTerm18mo <- function(df) {
account_name <- "Fixed Term 18mo"
open_date <- as.Date("2025-06-12")
close_date <- as.Date("2026-12-12")
principal <- 10000
rate <- 0.05
df$Date <- as.Date(df$Date)
interest_dates <- as.Date(c("2026-06-12", "2026-12-12"))
df[[account_name]] <- 0
# Start with last interest date = open date
last_interest_date <- open_date
for (int_date in interest_dates) {
int_date <- as.Date(int_date)
month_row <- which(format(df$Date, "%Y-%m") == format(int_date, "%Y-%m"))
if (length(month_row) == 1) {
# Calculate only the time since last interest payment
time <- as.numeric(difftime(int_date, last_interest_date, units = "days")) / 365.25
interest <- principal * rate * time
df[[account_name]][month_row] <- interest
principal <- principal + interest
# Update last_interest_date for next iteration
last_interest_date <- int_date
}
}
return(df)
}
Add_MonthlyPaymentAccount <- function(df) {
account_name <- "Monthly Payment Account"
open_date <- as.Date("2024-10-17")
interest_payment_date <- open_date %m+% months(12)  # 12 months after opening
monthly_payment <- 200
rate <- 0.065
df$Date <- as.Date(df$Date)
# Initialize the account column with 0
df[[account_name]] <- 0
# Calculate number of payments made by each month
# Payments start the month after opening (assumed)
df <- df %>%
mutate(
PaymentsMade = if_else(Date >= (open_date %m+% months(1)),
pmin(as.integer(interval(open_date, Date) %/% months(1)) + 1, 12),
0),
Principal = PaymentsMade * monthly_payment
)
# Find row of interest payment month
int_row <- which(format(df$Date, "%Y-%m") == format(interest_payment_date, "%Y-%m"))
if (length(int_row) == 1) {
# Interest calculated on the total principal accumulated over 12 months
# For simplicity, assume monthly contributions do not accrue interest until the 12 months are complete (i.e., no compounding during the year)
# Average principal over the year can be approximated as sum of an arithmetic series:
# total principal = 200 * 12 = 2400
# Average principal over year = 200 * (1 + 12)/2 = 1300 (since contributions happen monthly)
# Interest = average principal * rate * 1 year
avg_principal <- monthly_payment * (1 + 12) / 2
interest <- avg_principal * rate * 1
df[[account_name]][int_row] <- interest
}
# Remove helper columns
df <- df %>% select(-PaymentsMade, -Principal)
return(df)
}
Add_Trading212 <- function(df) {
account_name <- "Trading212"
# Initialize column with zeros
df[[account_name]] <- 0
# Specific interest payment dates and amounts
interest_dates <- as.Date(c("2025-05-01", "2025-06-01"))  # Using 1st of month for June
interest_amounts <- c(74.31, 73.94)
df$Date <- as.Date(df$Date)
for (i in seq_along(interest_dates)) {
# Find the row matching year-month of interest payment date
row_idx <- which(format(df$Date, "%Y-%m") == format(interest_dates[i], "%Y-%m"))
if (length(row_idx) == 1) {
df[[account_name]][row_idx] <- interest_amounts[i]
}
}
return(df)
}
Add_Trading212_new <- function(df) {
account_name <- "Trading212_new"
opening_balance <- 3215.76
annual_rate <- 0.041
monthly_rate <- annual_rate / 12
df[[account_name]] <- 0  # Initialize
# Find rows starting from June 2025
start_row <- which(df$Date >= as.Date("2025-06-01"))[1]
if (is.na(start_row)) return(df)  # If June 2025 isn't in df, return as-is
balance <- opening_balance
for (i in seq(start_row, nrow(df))) {
interest <- balance * monthly_rate
df[[account_name]][i] <- interest
balance <- balance + interest  # Compound
}
return(df)
}
Add_MonthlyPaymentAccount2 <- function(df) {
account_name <- "Lloyds Saver"
open_date <- as.Date("2025-05-05")
interest_payment_date <- open_date %m+% months(12)  # 12 months after opening
monthly_payment <- 400
rate <- 0.0625
df$Date <- as.Date(df$Date)
# Initialize the account column with 0
df[[account_name]] <- 0
# Calculate number of payments made by each month (starting the month of open_date)
df <- df %>%
mutate(
PaymentsMade = if_else(Date >= open_date,
pmin(as.integer(interval(open_date, Date) %/% months(1)) + 1, 12),
0),
Principal = PaymentsMade * monthly_payment
)
# Find row of interest payment month
int_row <- which(format(df$Date, "%Y-%m") == format(interest_payment_date, "%Y-%m"))
if (length(int_row) == 1) {
# Calculate average principal over the year as arithmetic mean of monthly contributions
avg_principal <- monthly_payment * (1 + 12) / 2
interest <- avg_principal * rate * 1  # 1 year interest
df[[account_name]][int_row] <- interest
}
# Remove helper columns
df <- df %>% select(-PaymentsMade, -Principal)
return(df)
}
FinancialYearMonthlyTable <- function(df, start_fy_year = 2025) {
library(dplyr)
library(lubridate)
start_date <- as.Date(paste0(start_fy_year, "-04-01"))
end_date <- as.Date(paste0(start_fy_year + 1, "-03-31"))
fy_data <- df %>%
filter(Date >= start_date & Date <= end_date) %>%
mutate(Month = format(Date, "%Y-%m")) %>%
select(-Date)
# Identify numeric columns only (accounts)
numeric_cols <- sapply(fy_data, is.numeric)
# Add a Total column summing only numeric columns
fy_data <- fy_data %>%
mutate(Total = rowSums(across(which(numeric_cols))))
# Add a Total row summing columns (including Total column)
total_row <- fy_data %>%
summarise(across(where(is.numeric), sum)) %>%
mutate(Month = "Total")
# Bind total row at the bottom
result <- bind_rows(fy_data, total_row)
# Reorder columns so Month is first
result <- result %>%
select(Month, everything())
return(result)
}
interest_data <- Add_FixedTerm18mo(interest_data)
interest_data <- Add_MonthlyPaymentAccount(interest_data)
interest_data <- Add_MonthlyPaymentAccount2(interest_data)
interest_data <- Add_Trading212(interest_data)
interest_data <- Add_Trading212_new(interest_data)
interest_data
plots <- PlotCumulativeInterestByFY(interest_data, start_years = c(2025, 2026))
# To display the plots, e.g. in RStudio:
print(plots$FY_2025_2026)
print(plots$FY_2026_2027)
ProjectedSummary(interest_data, 2026)
FinancialYearMonthlyTable(interest_data, 2025)
FinancialYearMonthlyTable(interest_data, 2026)
install.packages(c("bayestestR", "broom", "cli"))
install.packages(c("commonmark", "cowplot", "data.table", "datawizard"))
install.packages(c("doBy", "fitdistrplus", "future", "glmnet"))
install.packages(c("httr2", "parallelly", "parameters", "pbkrtest", "performance"))
install.packages(c("pillar", "pROC", "purrr", "quarto"))
install.packages(c("renv", "rlang", "rprojroot", "rsample", "shiny", "sjmisc"))
install.packages(c("Rcpp", "RcppArmadillo", "sjPlot", "terra"))
install.packages(c("V8", "waldo"))
install.packages("Epi")
library(knitr)
detach("package:knitr", unload = TRUE)
install.packages("knitr")
library(stats)
install.packages("stats")
library(dplyr)
library(dplyr)
x = vector("numeric", 10)
x
x[0]
x[1]
x = 1:10
x[1]
x[0]
x = matrix(NA, nrow=3, ncol=3)
x[0]
x
x[1,3]
x[1][2]
x = matrix(4:12, nrow=3, ncol=3)
x[1][2]
x
x[1][2]
x[1,2]
install.packages("ROCR")
install.packages("sjPlot")
setwd("D:/WindowsGitThings/stats-weektemplate/Ch6")
setwd("D:/WindowsGitThings/quarto-dev/invis")
setwd("D:/WindowsGitThings/quarto-dev/invis/_extensions/invis")
